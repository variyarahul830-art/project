<!DOCTYPE html>
<html>
<head>
    <title>Test Hasura Connection</title>
</head>
<body>
    <h1>Test Hasura GraphQL</h1>
    <button onclick="testCreateSession()">Test Create Session</button>
    <button onclick="testGetSessions()">Test Get Sessions</button>
    <pre id="output"></pre>

    <script>
        const HASURA_URL = 'http://localhost:8081/v1/graphql';
        const HASURA_SECRET = 'myadminsecret';

        async function testCreateSession() {
            const sessionId = `test_${Date.now()}`;
            const query = `
                mutation {
                    insert_chat_sessions_one(object: {
                        session_id: "${sessionId}",
                        user_id: "user123",
                        title: "Test from HTML",
                        category: "General"
                    }) {
                        id
                        session_id
                        title
                    }
                }
            `;

            try {
                const response = await fetch(HASURA_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-hasura-admin-secret': HASURA_SECRET
                    },
                    body: JSON.stringify({ query })
                });

                const result = await response.json();
                document.getElementById('output').textContent = JSON.stringify(result, null, 2);
                console.log('Create session result:', result);
            } catch (error) {
                document.getElementById('output').textContent = 'Error: ' + error.message;
                console.error('Error:', error);
            }
        }

        async function testGetSessions() {
            const query = `
                query {
                    chat_sessions(where: {user_id: {_eq: "user123"}}) {
                        id
                        session_id
                        title
                        created_at
                    }
                }
            `;

            try {
                const response = await fetch(HASURA_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-hasura-admin-secret': HASURA_SECRET
                    },
                    body: JSON.stringify({ query })
                });

                const result = await response.json();
                document.getElementById('output').textContent = JSON.stringify(result, null, 2);
                console.log('Get sessions result:', result);
            } catch (error) {
                document.getElementById('output').textContent = 'Error: ' + error.message;
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>
